<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site.title }} - {% if title %}{{ title }}{% else %}Welcome Home{% endif %}</title>
    <meta name="description" content="{{ site.description }}">
    <meta name="follow.it-verification-code" content="QSPpWgDE4SJdrfvcEJ31"/>

    <!-- Google Fonts for cozy feel -->
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
    {% include "header.njk" %}

    <main class="container">
        {{ content | safe }} {# This is where page-specific content will be injected #}
    </main>

    {% include "footer.njk" %}
    
    {# === NETLIFY IDENTITY WIDGET SCRIPT === #}
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            if (window.location.hash && window.location.hash.includes("invite_token")) {
              window.netlifyIdentity.open();
            }
          }
        });
      }
    </script>

    {# YOUR MAIN CUSTOM SCRIPT #}
    <script src="/assets/js/main.js"></script>

    {# === EMAIL SUBSCRIPTION POPUP === #}
    <div id="email-popup-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: white; padding: 40px; border-radius: 10px; max-width: 500px; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <button id="close-popup" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 30px; cursor: pointer; color: #666;">&times;</button>

            <style>
                .popup-followit--follow-form-container .form-preview {
                    display: flex !important;
                    flex-direction: column !important;
                    justify-content: center !important;
                    margin-top: 0 !important;
                    padding: 20px !important;
                    box-shadow: none !important;
                    border-radius: 6px !important;
                }
                .popup-followit--follow-form-container .form-preview .preview-heading {
                    width: 100% !important;
                }
                .popup-followit--follow-form-container .form-preview .preview-heading h5 {
                    margin-top: 0 !important;
                    margin-bottom: 10px !important;
                    font-size: 24px !important;
                }
                .popup-followit--follow-form-container .form-preview .preview-input-field {
                    margin-top: 20px !important;
                    width: 100% !important;
                }
                .popup-followit--follow-form-container .form-preview .preview-input-field input {
                    width: 100% !important;
                    height: 45px !important;
                    border-radius: 6px !important;
                    border: 2px solid #e9e8e8 !important;
                    background-color: #fff !important;
                    outline: none !important;
                    padding: 0 15px !important;
                    font-size: 16px !important;
                }
                .popup-followit--follow-form-container .form-preview .preview-submit-button {
                    margin-top: 15px !important;
                    width: 100% !important;
                }
                .popup-followit--follow-form-container .form-preview .preview-submit-button button {
                    width: 100% !important;
                    height: 45px !important;
                    border: 0 !important;
                    border-radius: 6px !important;
                    font-size: 18px !important;
                    cursor: pointer !important;
                }
                .popup-followit--follow-form-container .powered-by-line {
                    margin-top: 15px !important;
                    text-align: center !important;
                    font-size: 12px !important;
                    color: #666 !important;
                }
            </style>

            <div class="popup-followit--follow-form-container">
                <form action="https://api.follow.it/subscription-form/L0IvVUp5YldaUDQybSt4NU83STZPNkh4Uzg1Qm12RmxOQkczbEY1V0pmMEFEaG9BOFpFZFFlS2RVVUc1bkNsVUlGa3E0Z3d1SUw4bER5WG1xKzNwOTBpUHFMd1VnVm9hcGkxMVhwd2NSeVhpUlZOY2ltMHo3ZVcxUmhvdTRmczF8ZHB3V3JNTko1RjFGMTAvMm8wZCsyU05hQVBrUlRYa0h3ZXdTZHprTDZ3Zz0=/8" method="post">
                    <div class="form-preview" style="background-color: rgb(207, 78, 217); border: 1px solid rgb(204, 204, 204); border-radius: 6px;">
                        <div class="preview-heading">
                            <h5 style="font-family: Arial; font-weight: bold; color: rgb(0, 0, 0); text-align: center;">Never miss a cozy story!</h5>
                            <p style="text-align: center; color: rgb(0, 0, 0); margin: 10px 0;">Get new posts delivered to your inbox</p>
                        </div>
                        <div class="preview-input-field">
                            <input type="email" name="email" required placeholder="Enter your email" style="font-family: Arial; color: rgb(0, 0, 0); text-align: center; background-color: rgb(255, 255, 255);">
                        </div>
                        <div class="preview-submit-button">
                            <button type="submit" style="font-family: Arial; font-weight: bold; color: rgb(255, 255, 255); background-color: rgb(0, 0, 0);">Subscribe Now</button>
                        </div>
                    </div>
                </form>
                <a href="https://follow.it" class="powered-by-line" style="display: block; text-decoration: none;">Powered by follow.it</a>
            </div>
        </div>
    </div>

    <script>
        // Show popup after 5 seconds on every page load
        setTimeout(function() {
            document.getElementById('email-popup-overlay').style.display = 'flex';
        }, 5000); // 5 seconds

        // Close popup when X is clicked
        document.getElementById('close-popup').addEventListener('click', function() {
            document.getElementById('email-popup-overlay').style.display = 'none';
        });

        // Close popup when clicking outside
        document.getElementById('email-popup-overlay').addEventListener('click', function(e) {
            if (e.target.id === 'email-popup-overlay') {
                document.getElementById('email-popup-overlay').style.display = 'none';
            }
        });
    </script>
</body>
</html>
